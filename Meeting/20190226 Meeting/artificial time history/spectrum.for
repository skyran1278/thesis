$DEBUG
	PROGRAM SPECTRUM
C	Determine Elastic Response Spectrum
	
	IMPLICIT REAL*8 (A-H,O-Z)
	DIMENSION T(35000),AA(35000),FF(35000)
     &          
     		
	PI=4*ATAN(1.0)

	OPEN(1,FILE='AT.DAT',STATUS='OLD')
	READ (1,*,END=10) (T(I),AA(I),I=1,35000) 
10	LT=I-1
	DT=T(2)-T(1)
	CLOSE(1)

	OPEN(100,FILE='SPE.DAT',STATUS='OLD')

C	NATURAL FREQUENCY
	OPEN(2,FILE='FREQ.DAT',STATUS='OLD')
	READ (2,*,END=20) (FF(I),XXX,I=1,35000)
20	LF=I-1
	CLOSE(2)

C	Matrix A & B
	XI=0.05
	SXI=(1-XI**2)**(0.5);

	DO 200 L=1,LF
	F=FF(L)
	W=2*PI*F
	WD=W*SXI
	W2DT=W**2*DT
	W3DT=W**3*DT
	SN=SIN(WD*DT)
	CS=COS(WD*DT)
	EP=EXP(-XI*W*DT)

	A11=EP*(XI/SXI*SN+CS)
	A12=EP*SN/WD
	A21=-EP*W/SXI*SN
	A22=EP*(CS-XI/SXI*SN)

	B11=EP*((XI/W-(1-2*XI**2)/W2DT)*SN/WD+(1/W**2+2*XI/W3DT)*CS)
     &	-2*XI/W3DT
	B12=EP*((1-2*XI**2)/W2DT*SN/WD-2*XI/W3DT*CS)+2*XI/W3DT-1/W**2
	B21=-EP*(1/W2DT*CS+(1/WD+XI/(SXI*W2DT))*SN)+1/W2DT
	B22=EP*(1/W2DT*CS+XI/(SXI*W2DT)*SN)-1/W2DT
	
	U0=0
	V0=0
	
	AMAX=0

	DO 50 N=2,LT
	UU=A11*U0+A12*V0+B11*AA(N-1)+B12*AA(N)
	VV=A21*U0+A22*V0+B21*AA(N-1)+B22*AA(N)
	AT=-2*XI*W*VV-W**2*UU
	IF (ABS(AT) .GT. AMAX)	AMAX=ABS(AT)
	U0=UU
	V0=VV
50	CONTINUE

	
	WRITE(100,*) F,AMAX

200	CONTINUE
	CLOSE(100)
	
	STOP
	END	

